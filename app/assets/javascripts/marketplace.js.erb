$(function(){

  function searchFliterSort (){
    var url = window.location.pathname + '/marketplace_ajax_sort'
    var search = $('.marketplace-search').val();
    var category = $('#listings').data('categoryId');
    var sortValue = $('#marketplace-sort-listing option:selected').val();
    var distanceValue = $('#marketplace-distance-filter option:selected').val();
    $.ajax({
      url: url,
      type: 'GET',
      dataType: 'script',
      data: {
        search: search,
        category_id: category,
        sort: sortValue,
        distance_filter: distanceValue
      },
    }).done(function(){
       $(document).foundation('interchange', 'reflow');
       $(document).foundation('interchange', 'resize');
    });
  }
  $('#marketplace-search-button').on('click', searchFliterSort);

  $('#marketplace-sort-listing, #marketplace-distance-filter').on('change', searchFliterSort);

  $('#marketplace-search').on('keyup', searchFliterSort);
});